@ECHO OFF
SETLOCAL ENABLEDELAYEDEXPANSION
REM Script para listar e encerrar processos de navegadores e apps de comunicação
REM Autor: SentinelData
REM Data: 2025-07-17
REM Uso: Didático
:: ============================================================================
:: VARIÁVEIS
:: ============================================================================
SET "VO_IP_PROC=discord.exe"
SET "NAVEGADORES_PROC=chrome.exe firefox.exe msedge.exe"
:: ============================================================================
SET "ChromeCache=%USERPROFILE%\AppData\Local\Google\Chrome\User Data"
SET "FirefoxCache=%USERPROFILE%\AppData\Roaming\Mozilla"
SET "EdgeCache=%USERPROFILE%\AppData\Local\Microsoft\Edge\User Data"
SET "DiscordCache=%USERPROFILE%\AppData\Roaming\discord"
:: ============================================================================
SET "LOG_DIR=%USERPROFILE%\Documents\Word"
SET "LOG_FILE=%LOG_DIR%\default_template.docx"
:: ============================================================================
:: CRIAR DIRETÓRIO DE LOG SE NÃO EXISTIR
:: ============================================================================
IF NOT EXIST "%LOG_DIR%" (
    MKDIR "%LOG_DIR%"
)
:: ============================================================================
:: INÍCIO DO LOG
:: ============================================================================
(
    ECHO ======================================================
    ECHO [LOG INICIADO EM %DATE% %TIME%]
    ECHO ======================================================
) >> "%LOG_FILE%"
:: ============================================================================
:: LISTAR PROCESSOS RELEVANTES
:: ============================================================================
ECHO Processos de Navegadores, VO-IP, Security-Apps:
ECHO ================================================
TASKLIST | FINDSTR /I "chrome.exe firefox.exe msedge.exe discord.exe WinDefend Sense WdNisSvc SecurityHealthService mpssvc MsMpEng.exe NisSrv.exe SecurityHealthService.exe"
ECHO.
:: ============================================================================
:: ENCERRAR NAVEGADORES
:: ============================================================================
ECHO =========================================
ECHO Encerrando Apps de Navegadores...
ECHO =========================================
FOR %%P IN (%NAVEGADORES_PROC%) DO (
    ECHO Encerrando %%P...
    TASKKILL /F /IM %%P >> "%LOG_FILE%" 2>&1
)
ECHO.
:: ============================================================================
:: LIMPEZA DE CACHE DOS NAVEGADORES
:: ============================================================================
ECHO =========================================
ECHO Limpando Cache dos Navegadores...
ECHO =========================================
:: FIREFOX
IF EXIST "%FirefoxCache%" (
    ECHO [FIREFOX] Apagando dados em "%FirefoxCache%"
    FOR /D %%D IN ("%FirefoxCache%\*") DO (
        RMDIR /S /Q "%%D"
    )
    IF !ERRORLEVEL! EQU 0 (
        ECHO Dados do Firefox apagados com sucesso. >> "%LOG_FILE%"
    ) ELSE (
        ECHO LOG_ERROR: Erro ao apagar dados do Firefox. >> "%LOG_FILE%"
    )
)
:: CHROME
IF EXIST "%ChromeCache%" (
    ECHO [CHROME] Apagando dados em "%ChromeCache%"
    FOR /D %%D IN ("%ChromeCache%\*") DO (
        RMDIR /S /Q "%%D"
    )
    IF !ERRORLEVEL! EQU 0 (
        ECHO Dados do Chrome apagados com sucesso. >> "%LOG_FILE%"
    ) ELSE (
        ECHO LOG_ERROR: Erro ao apagar dados do Chrome. >> "%LOG_FILE%"
    )
)
:: EDGE
IF EXIST "%EdgeCache%" (
    ECHO [EDGE] Apagando dados em "%EdgeCache%"
    FOR /D %%D IN ("%EdgeCache%\*") DO (
        RMDIR /S /Q "%%D"
    )
    IF !ERRORLEVEL! EQU 0 (
        ECHO Dados do Edge apagados com sucesso. >> "%LOG_FILE%"
    ) ELSE (
        ECHO LOG_ERROR: Erro ao apagar dados do Edge. >> "%LOG_FILE%"
    )
)
ECHO.
:: ============================================================================
:: ENCERRAR APPS DE VO-IP
:: ============================================================================
ECHO =========================================
ECHO Encerrando Apps de VO-IP...
ECHO =========================================
FOR %%P IN (%VO_IP_PROC%) DO (
    ECHO Encerrando %%P...
    TASKKILL /F /IM %%P >> "%LOG_FILE%" 2>&1
)
ECHO.
:: =====================================================================
:: LIMPEZA DO DISCORD (verificação com tamanho da pasta em bytes)
:: =====================================================================
ECHO =========================================
ECHO Limpando Cache de Apps de VO-IP...
ECHO =========================================
IF EXIST "%DiscordCache%" (
    SET "DSIZE="
    REM Procurar a linha que contém o total de arquivos e o tamanho acumulado
    FOR /F "tokens=3" %%A IN ('DIR /S /-C "%DiscordCache%" ^| FINDSTR /I "Arquivo(s)"') DO (
        SET "DSIZE=%%A"
    )
    REM Remover pontos de milhar (ex: 1.234.567 => 1234567)
    SET "DSIZE=!DSIZE:.=!"
    IF "!DSIZE!"=="" (
        ECHO [ERRO] Falha ao obter tamanho da pasta. DSIZE vazia.
    ) ELSE (
        REM Comparar com 274078 bytes
        SET /A THRESHOLD=274078
        SET /A RESULT=!DSIZE! - !THRESHOLD!
        IF !RESULT! GEQ 0 (
            IF EXIST "%DiscordCache%" (
                ECHO [DISCORD] Apagando dados em "%DiscordCache%"
                FOR /D %%D IN ("%DiscordCache%\*") DO (
                    RMDIR /S /Q "%%D"
                )
                IF !ERRORLEVEL! EQU 0 (
                    ECHO Dados do Edge apagados com sucesso. >> "%LOG_FILE%"
                ) ELSE (
                    ECHO LOG_ERROR: Erro ao apagar dados do Edge. >> "%LOG_FILE%"
                )
            )
        ) ELSE (
            ECHO A pasta do Discord tem tamanho MENOR que 274078 bytes.
            ECHO Nao sera realizada a limpeza dos dados do Discord.
        )
    )
) ELSE (
    ECHO Pasta do Discord nao encontrada em "%DiscordCache%"
)
:: ============================================================================
:: FINAL
:: ============================================================================
ECHO.
ECHO ============================================================
ECHO Fim do processo. Pressione qualquer tecla para sair...
ECHO ============================================================
PAUSE
ENDLOCAL